(this.webpackJsonpgame=this.webpackJsonpgame||[]).push([[4],{124:function(e,t,r){"use strict";r.r(t);var n=r(0),c=r(62),o=r(3),i=Object(c.a)({overlay:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"transparent",overflow:"hidden"}}),a=function(e){var t=e.zIndex;return Object(o.jsx)("div",{className:i().overlay,style:{zIndex:t}})},u=function(e){var t=e.videoId;return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)("video",{children:Object(o.jsx)("source",{src:"".concat("rtmp://localhost/oflaDemo","/").concat(t)})}),Object(o.jsx)(a,{zIndex:1})]})},s=r(77),l=function(e){var t=e.data,r=e.onClick;return Object(o.jsxs)("button",{id:t.id,className:"controls__key ".concat(t.active?"keyboard__key--active":""),onClick:function(){return r(t.id,"keydown")},children:[t.id,Object(o.jsx)("img",{src:t.img,alt:"keyboard button",className:"controls__image"})]})},d=r(78);function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){Object(d.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var v=function(e,t,r){return e.map((function(e){return e.id===t?b(b({},e),{},{active:r}):e}))},j=r.p+"static/media/caret-square-left-regular.d2b158ae.svg",m=r.p+"static/media/caret-square-right-regular.843d4198.svg",O=r.p+"static/media/caret-square-up-regular.72c44358.svg",p=r.p+"static/media/caret-square-down-regular.07b1c3b2.svg",y=(r(99),[{id:"w",img:O},{id:"a",img:j},{id:"s",img:p},{id:"d",img:m}]),g=function(e){var t=e.onAction,r=Object(n.useState)(y),c=Object(s.a)(r,2),i=c[0],a=c[1],u=Object(n.useRef)({}),d=Object(n.useCallback)((function(e,r){clearTimeout(u.current[e]||void 0),a((function(t){return v(t,e,!0)})),t(e,r),u.current[e]=window.setTimeout((function(){return a((function(t){return v(t,e,!1)}))}),1e3)}),[t]),f=Object(n.useCallback)((function(e){"w"!==e.key&&"a"!==e.key&&"s"!==e.key&&"d"!==e.key||d(e.key,e.type)}),[d]);return Object(n.useEffect)((function(){return window.addEventListener("keydown",f),window.addEventListener("keyup",f),function(){window.removeEventListener("keydown",f),window.removeEventListener("keyup",f)}}),[f]),Object(o.jsx)("section",{className:"controls",children:i.map((function(e){return Object(o.jsx)(l,{data:e,onClick:d},e.id)}))})},w=r(2),h=r(79),k=r(28);t.default=function(){var e=Object(h.b)(k.c),t=e.serverUrl,r=e.gameId,c=function(e){var t=e.serverUrl,r=e.gameId,c=Object(n.useState)(),o=Object(s.a)(c,2),i=o[0],a=o[1],u=Object(n.useRef)();Object(n.useEffect)((function(){var e,n=function(e){return a(e.type)};return!i&&r&&t&&(console.log("Trying to establish connection with server with gameId ".concat(r)),u.current=new WebSocket((e=r,"".concat(t,"/game/").concat(e,"/player"))),u.current.addEventListener("message",n),u.current.addEventListener("open",n),u.current.addEventListener("close",n),u.current.addEventListener("error",n)),console.log("rerender websocket effect",u.current,i,r,t),function(){u.current&&"error"===i&&(console.log("Closing connection with server"),u.current.removeEventListener("message",n),u.current.removeEventListener("open",n),u.current.removeEventListener("close",n),u.current.removeEventListener("error",n),u.current.close())}}),[i,r,t]),Object(n.useEffect)((function(){return function(){var e;return null===(e=u.current)||void 0===e?void 0:e.close()}}),[]);var l=Object(n.useCallback)((function(e){u.current&&"open"===i&&u.current.send(e)}),[i]);return{status:i,onAction:l}}({serverUrl:t,gameId:r}),i=c.status,a=c.onAction,l=Object(w.g)(),d=Object(h.a)(),f=Object(n.useCallback)((function(e,t){a("".concat(e.toUpperCase(),"_").concat("keyup"===t?"UP":"DOWN"))}),[a]);return Object(n.useEffect)((function(){"close"!==i&&"error"!==i&&(r||t)||(d(Object(k.b)({})),l.replace("/login"))}),[i,l,d,r,t]),Object(o.jsxs)("div",{className:"game",children:[Object(o.jsx)(u,{videoId:1}),Object(o.jsx)(g,{onAction:f})]})}},77:function(e,t,r){"use strict";function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,c=!1,o=void 0;try{for(var i,a=e[Symbol.iterator]();!(n=(i=a.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(u){c=!0,o=u}finally{try{n||null==a.return||a.return()}finally{if(c)throw o}}return r}}(e,t)||function(e,t){if(e){if("string"===typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}r.d(t,"a",(function(){return c}))},78:function(e,t,r){"use strict";function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.d(t,"a",(function(){return n}))},79:function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return o}));var n=r(29),c=function(){return Object(n.b)()},o=n.c},99:function(e,t,r){}}]);
//# sourceMappingURL=4.426a0b5d.chunk.js.map