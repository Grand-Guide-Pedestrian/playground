(this.webpackJsonpgame=this.webpackJsonpgame||[]).push([[5],{126:function(e,t,n){},147:function(e,t,n){"use strict";n.r(t);var r=n(98),c=n(99),o=n(104),i=n(103),a=n(0),s=n.n(a),u=n(89),l=n(3),d=Object(u.a)({overlay:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"transparent",overflow:"hidden"}}),v=function(e){var t=e.zIndex;return Object(l.jsx)("div",{className:d().overlay,style:{zIndex:t}})},b=n(127),f=function(e){Object(o.a)(n,e);var t=Object(i.a)(n);function n(){var e;Object(r.a)(this,n);for(var c=arguments.length,o=new Array(c),i=0;i<c;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).videoNode=void 0,e.player=void 0,e}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.player=b.a.createPlayer({type:"flv",isLive:!0,url:"http://18.192.37.20:8080/live/livestream.flv",hasAudio:!0,hasVideo:!0},{enableStashBuffer:!0,stashInitialSize:128}),b.a.LoggingControl.enableError=!1,b.a.LoggingControl.enableWarn=!0,this.player.attachMediaElement(this.videoNode),this.player.load(),this.player.play(),this.player.on("error",(function(e){console.log(e)}))}},{key:"componentWillUnmount",value:function(){this.player.destroy()}},{key:"render",value:function(){var e=this;return Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)("video",{controls:!0,ref:function(t){return e.videoNode=t},height:"100%",width:"100%",style:{width:"100vw",height:"100vh"}}),Object(l.jsx)(v,{zIndex:1})]})}}]),n}(s.a.Component),j=n(145),p=function(e){var t=e.id,n=e.onClick;return Object(l.jsx)(j.a,{id:t,className:"controls__key",onClick:function(){return n(t,"keydown")},children:t})},O=(n(126),n(34)),h=n(42),y=[{id:"w"},{id:"a"},{id:"s"},{id:"d"}],g=function(e){var t=e.onAction,n=Object(O.a)(),r=Object(O.b)(h.d),c=Object(a.useCallback)((function(e,r){t(e,r),n(Object(h.e)())}),[t,n]),o=Object(a.useCallback)((function(e){"w"!==e.key&&"a"!==e.key&&"s"!==e.key&&"d"!==e.key||n(Object(h.e)(e.key))}),[n]);return Object(a.useEffect)((function(){return window.addEventListener("keydown",o),window.addEventListener("keyup",o),function(){window.removeEventListener("keydown",o),window.removeEventListener("keyup",o)}}),[o]),Object(a.useEffect)((function(){var e;r&&(null===(e=document.querySelector("#".concat(r," > span.MuiTouchRipple-root")))||void 0===e||e.click())}),[r]),Object(l.jsx)("section",{className:"controls",children:y.map((function(e){return Object(l.jsx)(p,{id:e.id,onClick:c},e.id)}))})},m=n(111),k=n(15),w=n(4);t.default=function(){var e=Object(O.b)(h.c),t=e.serverUrl,n=e.gameId,r=function(e){var t=e.serverUrl,n=e.gameId,r=Object(a.useState)(),c=Object(m.a)(r,2),o=c[0],i=c[1],s=Object(a.useRef)(),u=Object(O.a)();Object(a.useEffect)((function(){var e,r=function(e){i(e.type)},c=function(e){u(Object(k.c)(e.reason)),i(e.type)};return!o&&n&&t&&(console.log("Trying to establish connection with server with gameId ".concat(n)),console.log("rerender websocket effect",s.current,o,n,t),s.current=new WebSocket((e=n,"".concat(t,"/game/").concat(e,"/player"))),s.current.addEventListener("message",r),s.current.addEventListener("open",r),s.current.addEventListener("close",c),s.current.addEventListener("error",r)),function(){!s.current||"error"!==o&&"close"!==o||(console.log("Closing connection with server"),s.current.removeEventListener("message",r),s.current.removeEventListener("open",r),s.current.removeEventListener("error",r),s.current.removeEventListener("close",c),s.current.close(),u(Object(h.b)({})))}}),[o,n,t,u]),Object(a.useEffect)((function(){return function(){var e;return null===(e=s.current)||void 0===e?void 0:e.close()}}),[]);var l=Object(a.useCallback)((function(e){s.current&&"open"===o&&s.current.send(e)}),[o]);return{status:o,onAction:l}}({serverUrl:t,gameId:n}),c=r.status,o=r.onAction,i=Object(w.g)(),s=Object(O.a)(),u=Object(a.useCallback)((function(e,t){o("".concat(e.toUpperCase(),"_").concat("keyup"===t?"UP":"DOWN"))}),[o]);return Object(a.useEffect)((function(){"close"!==c&&"error"!==c||(s(Object(h.b)({})),i.replace("/login"))}),[c,i,s,n,t]),Object(l.jsxs)("div",{className:"game",children:[Object(l.jsx)(f,{}),Object(l.jsx)(g,{onAction:u})]})}}}]);
//# sourceMappingURL=5.672d7351.chunk.js.map