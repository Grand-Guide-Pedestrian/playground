(this.webpackJsonpgame=this.webpackJsonpgame||[]).push([[5],{126:function(e,t,n){},147:function(e,t,n){"use strict";n.r(t);var r=n(98),c=n(99),o=n(104),i=n(103),a=n(0),s=n.n(a),u=n(89),l=n(3),d=Object(u.a)({overlay:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"transparent",overflow:"hidden"}}),v=function(e){var t=e.zIndex;return Object(l.jsx)("div",{className:d().overlay,style:{zIndex:t}})},b=n(127),f=function(e){Object(o.a)(n,e);var t=Object(i.a)(n);function n(){var e;Object(r.a)(this,n);for(var c=arguments.length,o=new Array(c),i=0;i<c;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).videoNode=void 0,e.player=void 0,e}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.player=b.a.createPlayer({type:"flv",isLive:!0,url:"http://18.192.37.20:8080/live/livestream.flv",hasAudio:!0,hasVideo:!0},{enableStashBuffer:!0,stashInitialSize:128}),b.a.LoggingControl.enableError=!1,b.a.LoggingControl.enableWarn=!0,this.player.attachMediaElement(this.videoNode),this.player.load(),this.player.play(),this.player.on("error",(function(e){console.log(e)}))}},{key:"componentWillUnmount",value:function(){this.player.destroy()}},{key:"render",value:function(){var e=this;return Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)("video",{controls:!0,ref:function(t){return e.videoNode=t},height:"100%",width:"100%",style:{width:"100vw",height:"100vh"}}),Object(l.jsx)(v,{zIndex:1})]})}}]),n}(s.a.Component),j=n(145),p=document.createEvent("MouseEvents");p.initEvent("mousedown",!0,!1);var O=document.createEvent("MouseEvents");O.initEvent("mouseup",!0,!1);var h=function(e){var t=e.id,n=e.onClick,r=e.active,c=Object(a.useRef)(null),o=Object(a.useCallback)((function(){n(t,"keydown"),setTimeout((function(){n(t,"keyup")}),500)}),[t,n]);return Object(a.useEffect)((function(){c.current&&r&&(!function(e){var t=e.querySelector(".MuiButton-label");null===t||void 0===t||t.dispatchEvent(p),setTimeout((function(){return null===t||void 0===t?void 0:t.dispatchEvent(O)}),500)}(c.current),o())}),[r,o]),Object(l.jsx)(j.a,{id:t,className:"controls__key",onClick:o,ref:c,children:t})},y=(n(126),n(34)),m=n(42),g=["q","w","e","a","s","d"],k=g.map((function(e){return{id:e}})),E=function(e){var t=e.onAction,n=Object(y.a)(),r=Object(y.b)(m.d),c=r.actionKey,o=r.actionType,i=Object(a.useCallback)((function(e,r){t(e,r),n(Object(m.e)())}),[t,n]),s=Object(a.useCallback)((function(e){-1!==g.indexOf(e.key)&&n(Object(m.e)({key:e.key,type:e.type}))}),[n]);return Object(a.useEffect)((function(){return window.addEventListener("keydown",s),function(){window.removeEventListener("keydown",s)}}),[s]),Object(l.jsx)("section",{className:"controls",children:k.map((function(e){return Object(l.jsx)(h,{id:e.id,onClick:i,active:e.id===c&&"keydown"===o},e.id)}))})},w=n(111),x=n(15),C=n(4);t.default=function(){var e=Object(y.b)(m.c),t=e.serverUrl,n=e.gameId,r=function(e){var t=e.serverUrl,n=e.gameId,r=Object(a.useState)(),c=Object(w.a)(r,2),o=c[0],i=c[1],s=Object(a.useRef)(),u=Object(y.a)();Object(a.useEffect)((function(){var e,r=function(e){i(e.type)},c=function(e){u(Object(x.c)(e.reason)),i(e.type)};return!o&&n&&t&&(console.log("Trying to establish connection with server with gameId ".concat(n)),console.log("rerender websocket effect",s.current,o,n,t),s.current=new WebSocket((e=n,"".concat(t,"/game/").concat(e,"/player"))),s.current.addEventListener("message",r),s.current.addEventListener("open",r),s.current.addEventListener("close",c),s.current.addEventListener("error",r)),function(){!s.current||"error"!==o&&"close"!==o||(console.log("Closing connection with server"),s.current.removeEventListener("message",r),s.current.removeEventListener("open",r),s.current.removeEventListener("error",r),s.current.removeEventListener("close",c),s.current.close(),u(Object(m.b)({})))}}),[o,n,t,u]),Object(a.useEffect)((function(){return function(){var e;return null===(e=s.current)||void 0===e?void 0:e.close()}}),[]);var l=Object(a.useCallback)((function(e){s.current&&"open"===o&&s.current.send(e)}),[o]);return{status:o,onAction:l}}({serverUrl:t,gameId:n}),c=r.status,o=r.onAction,i=Object(C.g)(),s=Object(y.a)(),u=Object(a.useCallback)((function(e,t){o("".concat(e.toUpperCase(),"_").concat("keyup"===t?"UP":"DOWN"))}),[o]);return Object(a.useEffect)((function(){"close"!==c&&"error"!==c&&(t||n||c)||(s(Object(m.b)({})),i.replace("/login"))}),[c,i,s,n,t]),Object(l.jsxs)("div",{className:"game",children:[Object(l.jsx)(f,{}),Object(l.jsx)(E,{onAction:u})]})}}}]);
//# sourceMappingURL=5.1581c19c.chunk.js.map